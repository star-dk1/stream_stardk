<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="StreamVibe ‚Äî Panel de administrador para transmisi√≥n en vivo">
    <title>StreamVibe ‚Äî Admin Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîß</text></svg>">
</head>

<body class="admin-page">
    <div class="bg-animated">
        <div class="bg-blob-3"></div>
    </div>
    <div class="toast-container" id="toast-container"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
        <span class="text-secondary">Verificando sesi√≥n...</span>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="/" class="navbar-brand">
                <span class="navbar-logo">üé¨ StreamVibe</span>
                <span class="text-secondary text-sm navbar-text">‚Äî Admin</span>
            </a>
            <div class="navbar-actions">
                <div id="stream-status-badge" class="offline-badge">
                    <span>OFFLINE</span>
                </div>
                <div class="viewer-count" id="viewer-counter">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                    </svg>
                    <span id="viewer-count-num">0</span>
                </div>
                <button class="btn btn-ghost btn-sm" id="logout-btn">üö™ Salir</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Controls Section -->
        <div class="admin-controls">
            <div class="controls-header">
                <h2>üéõÔ∏è Panel de Control</h2>
                <span class="text-secondary text-sm" id="admin-greeting">Hola, Admin</span>
            </div>

            <!-- Source Tabs -->
            <div class="source-tabs">
                <button class="source-tab active" data-source="camera" id="tab-camera">
                    üì∑ C√°mara
                </button>
                <button class="source-tab" data-source="screen" id="tab-screen">
                    üñ•Ô∏è Pantalla
                </button>
                <button class="source-tab" data-source="video" id="tab-video">
                    üé¨ Video MP4
                </button>
            </div>

            <!-- Preview -->
            <div class="preview-container">
                <video id="preview-video" autoplay muted playsinline></video>
                <div class="preview-placeholder" id="preview-placeholder">
                    <div class="icon">üì∑</div>
                    <div>Selecciona una fuente para comenzar</div>
                </div>
            </div>

            <div class="source-panel active" id="panel-camera">
                <div class="controls-row" style="flex-wrap: wrap; gap: 10px;">
                    <button class="btn btn-ghost" id="btn-get-camera">üì∑ Activar C√°mara</button>
                    
                    <div style="display:flex; flex-direction:column; gap:5px;">
                        <select class="input" id="camera-select" style="max-width:250px;">
                            <option value="">Seleccionar c√°mara...</option>
                        </select>
                        <select class="input" id="mic-select" style="max-width:250px;">
                            <option value="">Seleccionar micr√≥fono...</option>
                        </select>
                    </div>

                    <!-- Volume Meter -->
                    <div class="volume-meter-container" style="display:flex; align-items:center; gap:5px;">
                         <span style="font-size:12px;">üé§</span>
                         <div style="width: 100px; height: 10px; background: #333; border-radius: 5px; overflow: hidden;">
                             <div id="volume-bar" style="width: 0%; height: 100%; background: lime; transition: width 0.1s;"></div>
                         </div>
                    </div>
                </div>
            </div>

            <!-- Screen Panel -->
            <div class="source-panel" id="panel-screen">
                <div class="controls-row">
                    <button class="btn btn-ghost" id="btn-get-screen">üñ•Ô∏è Compartir Pantalla</button>
                    <span class="text-sm text-secondary">Se abrir√° el selector del navegador</span>
                </div>
            </div>

            <!-- Video Panel -->
            <div class="source-panel" id="panel-video">
                <div class="controls-row">
                    <div class="file-input-wrapper">
                        <button class="btn btn-ghost">üìÅ Seleccionar Video</button>
                        <input type="file" accept="video/*" id="video-file-input">
                    </div>
                    <span class="text-sm text-secondary" id="video-filename">Ning√∫n archivo seleccionado</span>
                </div>
                <video id="mp4-source-video" style="display:none;" crossorigin="anonymous"></video>
                <canvas id="mp4-canvas" style="display:none;"></canvas>
            </div>

            <!-- Stream Actions -->
            <div class="stream-actions">
                <input type="text" class="input" id="stream-title-input" placeholder="T√≠tulo del stream..."
                    value="Live Stream" maxlength="100">
                <button class="btn btn-primary btn-lg" id="btn-start-stream" disabled>
                    üî¥ Iniciar Stream
                </button>
                <button class="btn btn-danger btn-lg" id="btn-stop-stream" style="display:none;">
                    ‚¨õ Detener Stream
                </button>
            </div>

            <!-- Status -->
            <div class="status-bar offline" id="status-bar">
                <span>‚¨õ Stream offline ‚Äî Selecciona una fuente y presiona Iniciar</span>
            </div>
        </div>

        <!-- Admin Chat -->
        <aside class="admin-chat chat-sidebar">
            <div class="chat-header">
                <h3>üí¨ Chat en Vivo</h3>
                <div class="viewer-count">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                    </svg>
                    <span id="chat-count-num">0</span>
                </div>
            </div>
            <div class="chat-messages" id="chat-messages"></div>
            <div class="chat-input-area">
                <input type="text" class="input" id="chat-input" placeholder="Mensaje como ADMIN..." maxlength="500">
                <button class="btn btn-primary btn-sm" id="chat-send">Enviar</button>
            </div>
        </aside>
    </main>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
    <script src="/js/admin.js"></script>
</body>

</html>